# ADR 0007: シンプルMQのメッセージ設計（取り込みジョブ）

## ステータス
- 採用

## コンテキスト
- 取り込みは非同期ジョブとして実行し、キューに「さくらのシンプルMQ」を使用する。
- 現時点ではメッセージ種別のバリエーションはないため、typeは不要とする。
- 冪等性と再配信に備え、ジョブ単位で処理を追跡したい。
- 可視性タイムアウトはデフォルト30秒だが、必要に応じてキュー設定で調整できる。

## 決定
- メッセージは `job_id` のみを持つ最小構成とする。
  - 例: `{"job_id": 12345}`
- ワーカーは `job_id` を起点にDBから必要情報を取得する。
- リトライは最大5回までとし、超過した場合は `failed` で停止する。
- 可視性タイムアウトは当面30秒を前提にし、処理時間に応じて設定変更を検討する。

## 影響・結果
- メッセージサイズを最小化できる。
- 冪等性は `ingest_jobs` の `status` と `attempts` で担保する。
- 可視性タイムアウト調整の運用が必要になる可能性がある。
